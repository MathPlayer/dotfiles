#
# Rule of thumb for the Apple ecosystem: most of the default command-line tools are old/outdated,
# try switching to GNU alternatives if they are found.
#


# Source user's comnands file for helper functions.
if [ -f "${HOME}/.bin/commands.sh" ]; then
  source "${HOME}/.bin/commands.sh"
fi

### dircolors
function alias_dircolors() {
  local EXEC=""

  # Check if dircolors is available and switch to it.
  command_exists "dircolors" && EXEC="$(which dircolors)"

  # Check if gdircolors is available and switch to it.
  command_exists "gdircolors" && EXEC="$(which gdircolors)"


  # Load dircolors if existing.
  if [ -x "${EXEC}" ]; then
    test -r "~/.dircolors" && \
      eval "$(${EXEC} -b ~/.dircolors)" || \
      eval "$(${EXEC} -b)"
    # Failsafe alias for dircolors.
    alias dircolors="${EXEC}"
  fi
}
alias_dircolors
unset alias_dircolors


### rm
command_exists "grm" && alias rm="$(which grm)"


### tar
command_exists "gtar" && alias tar="'$(which gtar)'"


### ls
function alias_ls() {
  local EXEC="$(which ls)"
  local FLAG_COLOR=""
  local FLAG_GROUP_DIRECTORIES_FIRST=""
  local FLAG_HUMAN_SIZE=""
  local FLAG_INDICATOR=""

  # Check if gls is available and switch to it.
  command_exists "gls" && EXEC="$(which gls)"

  # Show colored output.
  if "${EXEC}" --color=auto >/dev/null 2>&1; then
    FLAG_COLOR="--color=auto"
  elif "${EXEC}" -G >/dev/null 2>&1; then
    FLAG_COLOR="-G"
  fi

  # Show size in human-readable format.
  if "${EXEC}" -lh >/dev/null 2>&1; then
    FLAG_HUMAN_SIZE="-h"
  fi

  # Add specific indicator after directory/socket/link/...
  if "${EXEC}" -F >/dev/null 2>&1; then
    FLAG_INDICATOR="-F"
  fi

  # Try to group directories first.
  if "${EXEC}" --group-directories-first >/dev/null 2>&1; then
    FLAG_GROUP_DIRECTORIES_FIRST="--group-directories-first"
  fi

  # Set aliases.
  local LS_COMMAND="${EXEC} ${FLAG_COLOR} ${FLAG_INDICATOR} ${FLAG_HUMAN_SIZE} ${FLAG_GROUP_DIRECTORIES_FIRST}"
  alias ls="${LS_COMMAND}"
  alias sl="${LS_COMMAND}"
  alias LS="${LS_COMMAND}"
  alias l="${LS_COMMAND} -l"
  alias ll="${LS_COMMAND} -l"
  alias la="${LS_COMMAND} -A"
  alias la="${LS_COMMAND} -A"
  alias lla="${LS_COMMAND} -lA"
}
alias_ls
unset alias_ls


### Various others
# Show colored output for various tools.
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Default to human readable figures.
alias df='df -h'
alias du='du -h'

# Add an "alert" alias for long running commands.  Use like so:
#   sleep 10; alert
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

# List only user's processes.
alias myps="ps axo user,tty,ppid,pid,command | grep -vE \"grep|ps axo\" | grep -E \"(USER\s*PPID)|$USER\""
alias mypsa="ps aux | grep -vE \"grep|ps aux\" | grep -E \"(USER\s*PID)|$USER\""

# Exit less if the output is small enough for only one screen
alias less='less -F'

# Force showing all output using tail
alias ftail='tail -f -n+1'

# SSH with logging
alias logssh='ssh > >(tee ssh-$(date +"%Y-%m-%d-%H-%M").out) 2> >(tee ssh-$(date +"%Y-%m-%d-%H-%M").err >&2)'
